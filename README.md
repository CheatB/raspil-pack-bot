# –†–∞—Å–ø–∏–ª –ü–∞–∫

Telegram-–±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–æ–¥–∑–∏-–ø–∞–∫–æ–≤ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –†–∞–∑–±–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ç–∞–π–ª—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–≤—å—é-–º–æ–∑–∞–∏–∫—É.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js 20+**, **TypeScript**
- **Monorepo** (pnpm workspaces)
- **Next.js 14** (App Router) –¥–ª—è API –º–∞—Ä—à—Ä—É—Ç–æ–≤
- **Telegraf** –¥–ª—è Telegram –±–æ—Ç–∞
- **Prisma + SQLite** –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Sharp** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **Vercel** –¥–ª—è –¥–µ–ø–ª–æ—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/apps
  /tg-bot       # –ö–æ–¥ –±–æ—Ç–∞ (core –ª–æ–≥–∏–∫–∞)
    /scripts    # –°–∫—Ä–∏–ø—Ç—ã (setWebhook)
  /web          # Next.js (API + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
  /processor    # –£—Ç–∏–ª–∏—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (sharp)
/packages
  /config       # –û–±—â–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏ (ESLint, TypeScript)
  /types        # –û–±—â–∏–µ —Ç–∏–ø—ã (Zod —Å—Ö–µ–º—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
/prisma         # Prisma —Å—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pnpm install
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
   ```env
   TG_BOT_TOKEN=your_bot_token
   WEBHOOK_SECRET=some-long-random-secret
   INTERNAL_KEY=internal-secret-key
   APP_BASE_URL=http://localhost:3000
   NODE_ENV=development
   DATABASE_URL="file:./dev.db"
   ```

4. **–í–∞–∂–Ω–æ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ `.env.local` –≤ `apps/web`:
   ```bash
   pnpm sync:env
   ```
   (Next.js —Ç—Ä–µ–±—É–µ—Ç `.env.local` –≤ —Å–≤–æ–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)

5. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma –∫–ª–∏–µ–Ω—Ç:
   ```bash
   pnpm prisma:generate
   ```

6. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   pnpm prisma:migrate
   ```

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Next.js dev server:
   ```bash
   pnpm dev
   ```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok/Cloudflared –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è):
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APP_BASE_URL –≤ .env.local –Ω–∞ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π URL
   pnpm set:webhook
   ```

–ë–æ—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ webhook –Ω–∞ –≤–∞—à–µ–º –ø—É–±–ª–∏—á–Ω–æ–º URL.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

1. –î–µ–ø–ª–æ–π –Ω–∞ Vercel
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Telegram:
   ```bash
   pnpm set:webhook
   ```
   (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ APP_BASE_URL –≤ .env —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à Vercel –¥–æ–º–µ–Ω)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Vercel)

–î–æ–±–∞–≤—å—Ç–µ –≤ Vercel ‚Üí Project ‚Üí Environment Variables:

- `TG_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `WEBHOOK_SECRET` - —Å–µ–∫—Ä–µ—Ç –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ webhook
- `INTERNAL_KEY` - –∫–ª—é—á –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤
- `APP_BASE_URL` - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–µ–∑ —Å–ª–µ—à–∞ –≤ –∫–æ–Ω—Ü–µ)
- `NODE_ENV` - `production`
- `DATABASE_URL` - –ø—É—Ç—å –∫ SQLite —Ñ–∞–π–ª—É (–¥–ª—è Vercel –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω—é—é –ë–î –∏–ª–∏ Vercel Postgres)

## API Endpoints

- `POST /api/tg/webhook` - Webhook –¥–ª—è Telegram (–∑–∞—â–∏—â–µ–Ω WEBHOOK_SECRET)
- `POST /api/process/preview` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é (internal)
- `GET /api/history/list` - –ò—Å—Ç–æ—Ä–∏—è –ø–∞–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (internal)
- `POST /api/packs/create` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–∞–∫–∞ (internal)

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è (MVP)
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ Telegram –±–æ—Ç —Å ReplyKeyboard –º–µ–Ω—é
- ‚úÖ –ü—Ä–∏–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ webhook
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–µ—Ç–∫–∏ (9-15 —Ç–∞–π–ª–æ–≤)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é-–º–æ–∑–∞–∏–∫–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –ø–∞–¥–¥–∏–Ω–≥–æ–º (0, 2, 4, 6px)
- ‚úÖ Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–¥–¥–∏–Ω–≥–∞
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–≤–æ—Ç (5 –æ–±—Ä–∞–±–æ—Ç–æ–∫/–º–µ—Å—è—Ü –¥–ª—è Free)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–∞–∫–æ–≤ (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
- ‚úÖ –ó–∞—â–∏—Ç–∞ webhook —á–µ—Ä–µ–∑ secret token

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- ‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ/GIF (ffmpeg)
- ‚è≥ –°–±–æ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏-–ø–∞–∫–∞ —á–µ—Ä–µ–∑ Telegram API
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- ‚è≥ –û–ø–ª–∞—Ç–∞ –∏ —Ç–∞—Ä–∏—Ñ—ã (Pro/Max)
- ‚è≥ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

## –ö–æ–º–∞–Ω–¥—ã

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pnpm dev              # –ó–∞–ø—É—Å–∫ Next.js dev server
pnpm build            # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
pnpm start            # –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
pnpm prisma:generate  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
pnpm prisma:migrate   # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

# Webhook
pnpm set:webhook      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –≤ Telegram
pnpm sync:env         # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è .env.local –º–µ–∂–¥—É –∫–æ—Ä–Ω–µ–º –∏ apps/web

# –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pnpm lint             # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
pnpm format           # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
pnpm typecheck        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

1. –ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º: `/start`
2. –ù–∞–∂–º–∏—Ç–µ "üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫"
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (PNG, JPG, WEBP, –¥–æ 10 –ú–ë)
4. –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–µ–≤—å—é –º–æ–∑–∞–∏–∫–∏
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞–¥–¥–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–æ–∫ "–ü–∞–¥–¥–∏–Ω–≥ -/+" (0, 2, 4, 6px)
6. –ù–∞–∂–º–∏—Ç–µ "–î–∞–ª—å—à–µ" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –õ–∏–º–∏—Ç—ã

- **Free**: –¥–æ 5 –æ–±—Ä–∞–±–æ—Ç–æ–∫/–º–µ—Å—è—Ü
- **Pro**: –¥–æ 50 –æ–±—Ä–∞–±–æ—Ç–æ–∫/–º–µ—Å—è—Ü (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **Max**: –¥–æ 200 –æ–±—Ä–∞–±–æ—Ç–æ–∫/–º–µ—Å—è—Ü (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
